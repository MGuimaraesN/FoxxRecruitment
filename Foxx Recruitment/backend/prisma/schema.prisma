datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  ACCEPTED
  REJECTED
}

model User {
  id                  Int                   @id @default(autoincrement())
  firstName           String
  lastName            String
  email               String                @unique
  password            String
  ip                  String
  lastLogin           DateTime?
  updatedAt           DateTime              @updatedAt
  createdAt           DateTime              @default(now())
  avatarUrl           String?
  resumeUrl           String?               // Novo: URL do Currículo (PDF)
  job                 Job[]
  institutions        UserInstitutionRole[]
  activeInstitutionId Int?
  bio                 String?
  linkedinUrl         String?
  githubUrl           String?
  portfolioUrl        String?
  course              String?
  graduationYear      Int?
  resetToken          String?               @unique
  resetTokenExpiry    DateTime?
  savedJobs           SavedJob[]
  applications        Application[]
  notifications       Notification[]        // Novo: Relacionamento com notificações
}

model Job {
  id            Int           @id @default(autoincrement())
  authorId      Int
  author        User          @relation(fields: [authorId], references: [id])
  title         String
  email         String
  telephone     String
  description   String
  areaId        Int
  area          Area          @relation(fields: [areaId], references: [id])
  categoryId    Int
  category      Category      @relation(fields: [categoryId], references: [id])
  status        String
  ip            String
  lastLogin     DateTime?
  updatedAt     DateTime      @updatedAt
  createdAt     DateTime      @default(now())
  deletedAt     DateTime?
  isPublic      Boolean       @default(false)
  institutionId Int
  institution   Institution   @relation(fields: [institutionId], references: [id])
  savedBy       SavedJob[]
  companyName   String?
  applications  Application[]
}

model Application {
  id        Int               @id @default(autoincrement())
  userId    Int
  user      User              @relation(fields: [userId], references: [id])
  jobId     Int
  job       Job               @relation(fields: [jobId], references: [id])
  status    ApplicationStatus @default(PENDING)
  createdAt DateTime          @default(now())
  resumeUrl String?           // Novo: Snapshot do currículo usado na aplicação

  @@unique([userId, jobId])
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  title     String
  message   String
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
}

model SavedJob {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  jobId     Int
  job       Job      @relation(fields: [jobId], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId, jobId])
}

model Category {
  id   Int   @id @default(autoincrement())
  name String @unique
  job  Job[]
}

model Area {
  id   Int   @id @default(autoincrement())
  name String @unique
  job  Job[]
}

model Institution {
  id    Int                   @id @default(autoincrement())
  name  String                @unique
  type  String                @default("university")
  isActive  Boolean           @default(true) // <--- ADICIONE ESTA LINHA
  jobs  Job[]
  users UserInstitutionRole[]
}

model Role {
  id    Int                   @id @default(autoincrement())
  name  String                @unique
  users UserInstitutionRole[]
}

model UserInstitutionRole {
  id            Int         @id @default(autoincrement())
  userId        Int
  user          User        @relation(fields: [userId], references: [id])
  institutionId Int
  institution   Institution @relation(fields: [institutionId], references: [id])
  roleId        Int
  role          Role        @relation(fields: [roleId], references: [id])

  @@unique([userId, institutionId])
}